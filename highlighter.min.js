"use strict";function Highlighter(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"is-highlighted";function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r={el:t,index:e,text:!1,size:0,children:[]},i=Array.from(t.childNodes);if(i.length>0){for(var a=e,o=0,s=0;s<i.length;s++){var l=n(i[s],a);r.children.push(l),o+=l.size,a+=l.size}r.size=o}else r.index=e,r.text=t.textContent,r.size=t.textContent.length;return r}function r(t){return t.sort(function(t,e){return t.start===e.start?t.end-t.start-(e.end-e.start):t.start-e.start})}function i(t,i,a){Array.isArray(a)||(a=[a]),a.forEach(function(e){t.allHighlights.push(e)}),function t(n,r){if(n.text){var i=n.text.trim();if(0===i.length)return;var a=n.index,o=a+n.size,s=r.filter(function(t){var e=t.start>=a&&t.start<=o,n=t.end>=a&&t.end<=o,r=t.start<a&&t.end>o;return e||n||r}).map(function(t){var e=Math.max(a,t.start),n=Math.min(o,t.end);return{start:e,end:n}}).sort(function(t,e){var n=t.end-t.start,r=e.end-e.start;return r-n});if(0===s.length)return;var l,u=s.reduce(function(t,e){return e.start in t||(t[e.start]={starts:0,ends:0}),e.end in t||(t[e.end]={starts:0,ends:0}),t[e.start].starts++,t[e.end].ends++,t},{}),c="";for(l=0;l<=n.text.length;l++){var d=u[a+l]||{starts:0,ends:0};d.starts>0||d.ends;for(var f=0;f<d.starts;f++)c+='<span class="'.concat(e,'">');for(var h=0;h<d.ends;h++)c+="</span>";l<n.text.length&&(c+=n.text[l])}var g=document.createElement("span");g.innerHTML=c,n.el.parentNode.insertBefore(g,n.el),n.el.parentNode.removeChild(n.el)}else for(var v=n.children,p=0;p<v.length;p++)t(v[p],r)}(n(i),r(a))}function a(t,e,n){for(var r=function t(e){return e.text?[e]:(e.children||[]).reduce(function(e,n){return t(n).forEach(function(t){e.push(t)}),e},[])}(t),i=[],a=!1,o=0;o<r.length;o++)r[o].el===e&&(a=!0),a&&i.push(r[o]),r[o].el===n&&(a=!1);return i}function o(t){var e=window.getSelection();if("Range"===e.type){var n=e.anchorNode,r=function t(e,n){if(e.el===n)return e;if(e.children.length>0)for(var r=0;r<e.children.length;r++){var i=t(e.children[r],n);if(i)return i}return!1}(t,n);r||console.error(r);var i=e.getRangeAt(0);e.rangeCount>1&&console.warn("Range count = ".concat(e.rangeCount,"."));var o=a(t,i.startContainer,i.endContainer),s=o.map(function(t,e){var n=t.text;return 0===e&&e===o.length-1?n=t.text.substring(i.startOffset,i.endOffset):0===e?n=t.text.substring(i.startOffset):e===o.length-1&&(n=t.text.substring(0,i.endOffset)),n}).reduce(function(t,e,n){return t+e},""),l=r.index+e.anchorOffset;return{el:n,start:l,end:l+s.length,text:s,timestamp:Date.now()}}return!1}function s(){Array.from(document.querySelectorAll(".is-tooltip")||[]).forEach(function(t){t.parentNode.removeChild(t)})}var l={allHighlights:[]};return{renderHighlights:function(e){return i(l,t,e)},removeHighlights:function(){return n=t,l.allHighlights=[],void Array.from(n.querySelectorAll(".".concat(e))).forEach(function(t){var e=document.createElement("span");e.textContent=t.textContent,t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t)});var n},onHighlight:function(e){return i=e,void((r=t).onmouseup=r.onkeyup=function(t){var e=o(n(r));if(e){s();var a=document.createElement("div");a.classList.add("is-tooltip"),a.textContent="Highlight",a.style.top="".concat(t.layerY+20,"px"),a.style.left="".concat(t.layerX-20,"px"),a.addEventListener("click",function(t){s(),i(e)}),document.body.appendChild(a)}});var r,i},getHighlights:function(){return l.allHighlights}}}